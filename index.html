<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vesak Day Scout Good Turns Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; background: #000; font-family: "Microsoft JhengHei", sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* é ‚éƒ¨ä»‹é¢ */
        .ui-panel {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: rgba(0, 0, 0, 0.7); color: gold;
            padding: 10px 30px; border-radius: 30px; border: 1px solid gold;
            text-align: center; backdrop-filter: blur(5px); min-width: 250px;
        }
        .lang-switch { position: absolute; top: 20px; right: 20px; z-index: 1000; }
        .lang-switch button { 
            background: gold; border: none; padding: 5px 12px; 
            border-radius: 5px; cursor: pointer; font-weight: bold;
        }
        
        /* è“®èŠ±ç‡ˆæ•ˆæœ */
        .lotus-icon {
            font-size: 24px; text-align: center;
            filter: drop-shadow(0 0 10px gold);
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { opacity: 0.6; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1.1); }
        }

        /* å½ˆçª—æ¨£å¼ */
        .modal {
            display: none; position: fixed; z-index: 2000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background: #fff; margin: 15% auto; padding: 30px;
            border-radius: 15px; width: 80%; max-width: 500px; text-align: center;
        }
        .quote-zh { font-size: 1.5em; color: #b71c1c; margin-bottom: 10px; font-weight: bold; }
        .quote-en { font-size: 1.1em; color: #555; font-style: italic; }
        .btn-close { margin-top: 20px; padding: 10px 20px; background: #b71c1c; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="lang-switch">
        <button onclick="switchLang('zh')">ä¸­</button>
        <button onclick="switchLang('en')">EN</button>
    </div>

    <div class="ui-panel">
        <h2 id="title" style="margin: 0; font-size: 1.2em;">è¡›å¡ç¯€ç«¥è»å–„è¡Œé»ç‡ˆ</h2>
        <div><span id="count-label">å…¨çƒå·²é»äº®ï¼š</span> <strong id="counter" style="font-size: 1.5em;">0</strong></div>
    </div>

    <div id="quote-modal" class="modal">
        <div class="modal-content">
            <div class="quote-zh" id="q-zh"></div>
            <div class="quote-en" id="q-en"></div>
            <button class="btn-close" onclick="closeModal()">Close / é—œé–‰</button>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. Firebase è¨­å®š ---
        // è«‹å°‡æ­¤è™•æ›¿æ›æˆä½ åœ¨ Firebase Console ç²å¾—çš„è¨­å®š
        const firebaseConfig = {
            apiKey: "ä½ çš„API_KEY",
            authDomain: "ä½ çš„å°ˆæ¡ˆID.firebaseapp.com",
            databaseURL: "https://ä½ çš„å°ˆæ¡ˆID-default-rtdb.firebaseio.com",
            projectId: "ä½ çš„å°ˆæ¡ˆID",
            storageBucket: "ä½ çš„å°ˆæ¡ˆID.appspot.com",
            messagingSenderId: "ä½ çš„ID",
            appId: "ä½ çš„APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- 2. ä½›å…‰èœæ ¹è­šæ¸…å–® ---
        const quotes = [
            { zh: "åšå¥½äº‹ï¼Œèªªå¥½è©±ï¼Œå­˜å¥½å¿ƒã€‚", en: "Do good deeds, speak good words, and think good thoughts." },
            { zh: "æ…ˆæ‚²å»£å¤§ï¼Œåˆ©ç›Šçœ¾ç”Ÿã€‚", en: "May compassion be vast and benefit all sentient beings." },
            { zh: "çµ¦äººä¿¡å¿ƒï¼Œçµ¦äººæ­¡å–œï¼Œçµ¦äººå¸Œæœ›ï¼Œçµ¦äººæ–¹ä¾¿ã€‚", en: "Give others confidence, joy, hope, and convenience." },
            { zh: "å¿ƒæ‡·æ„Ÿæ©ï¼Œå»£çµå–„ç·£ã€‚", en: "Be grateful and create many good affinities." },
            { zh: "æœ‰ä½›æ³•å°±æœ‰è¾¦æ³•ã€‚", en: "With the Dharma, there is a way." },
            { zh: "å¿ä¸€æ™‚é¢¨å¹³æµªéœï¼Œé€€ä¸€æ­¥æµ·é—Šå¤©ç©ºã€‚", en: "Tolerance brings peace; taking a step back opens up a wider world." },
            { zh: "åªè¦è‡ªè¦ºï¼Œå³æ˜¯ä½›æ€§ã€‚", en: "Awakening is the essence of Buddhahood." }
        ];

        // --- 3. åœ°åœ–åˆå§‹åŒ– ---
        let currentLang = 'zh';
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap | ä½›å…‰å±±æ˜Ÿé›²å¤§å¸«èœæ ¹è­š'
        }).addTo(map);

        const lotusIcon = L.divIcon({
            html: '<div class="lotus-icon">ğŸª·</div>',
            className: 'custom-div-icon',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });

        // --- 4. è³‡æ–™åº«äº’å‹• ---
        // ç›£è½æ–°é»ç‡ˆ
        db.ref('lamps').on('child_added', (snapshot) => {
            const data = snapshot.val();
            L.marker([data.lat, data.lng], {icon: lotusIcon}).addTo(map);
        });

        // ç›£è½ç¸½æ•¸
        db.ref('lamps').on('value', (snapshot) => {
            const count = snapshot.numChildren();
            document.getElementById('counter').innerText = count;
        });

        // é»æ“Šåœ°åœ–é»ç‡ˆ
        map.on('click', function(e) {
            const msg = currentLang === 'zh' ? "è¦åœ¨é€™è£¡é»äº®ä¸€ç›å–„è¡Œç‡ˆå—ï¼Ÿ" : "Light a lamp for your good turn here?";
            if (confirm(msg)) {
                // å„²å­˜åˆ° Firebase
                db.ref('lamps').push({
                    lat: e.latlng.lat,
                    lng: e.latlng.lng,
                    time: Date.now()
                });
                showQuote();
            }
        });

        function showQuote() {
            const q = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('q-zh').innerText = q.zh;
            document.getElementById('q-en').innerText = q.en;
            document.getElementById('quote-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('quote-modal').style.display = 'none';
        }

        function switchLang(lang) {
            currentLang = lang;
            document.getElementById('title').innerText = lang === 'zh' ? "è¡›å¡ç¯€ç«¥è»å–„è¡Œé»ç‡ˆ" : "Vesak Day Scout Good Turns Map";
            document.getElementById('count-label').innerText = lang === 'zh' ? "å…¨çƒå·²é»äº®ï¼š" : "Global Lights:";
        }
    </script>
</body>
</html>